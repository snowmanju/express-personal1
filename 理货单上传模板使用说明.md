# 理货单上传模板使用说明

## 📥 模板下载

模板文件位置：`static/templates/理货单上传模板.csv`

或者访问：http://localhost:8000/static/templates/理货单上传模板.csv

## 📋 模板格式说明

### 必填列（10列）

| 列名 | 说明 | 格式 | 示例 |
|------|------|------|------|
| 理货日期 | 理货日期 | YYYY-MM-DD | 2024-01-26 |
| 快递单号 | 快递单号（唯一） | 文本 | YT1234567890 |
| 集包单号 | 集包单号 | 文本 | PKG001 |
| 长度 | 长度（厘米） | 数字 | 20.5 |
| 宽度 | 宽度（厘米） | 数字 | 15.0 |
| 高度 | 高度（厘米） | 数字 | 10.0 |
| 重量 | 重量（千克） | 数字 | 1.5 |
| 货物代码 | 货物代码 | 文本 | GOODS001 |
| 客户代码 | 客户代码 | 文本 | CUST001 |
| 运输代码 | 运输代码 | 文本 | TRANS001 |

### 列名要求

⚠️ **重要**：列名必须完全匹配，包括中文字符！

✅ 正确的列名：
```
理货日期,快递单号,集包单号,长度,宽度,高度,重量,货物代码,客户代码,运输代码
```

❌ 错误的列名示例：
- `理货日期` 写成 `日期` ❌
- `快递单号` 写成 `单号` ❌
- `集包单号` 写成 `包裹号` ❌
- 使用英文列名 ❌

## 📝 示例数据

```csv
理货日期,快递单号,集包单号,长度,宽度,高度,重量,货物代码,客户代码,运输代码
2024-01-26,YT1234567890,PKG001,20.5,15.0,10.0,1.5,GOODS001,CUST001,TRANS001
2024-01-26,ZT9876543210,PKG002,25.0,20.0,15.0,2.0,GOODS002,CUST002,TRANS002
2024-01-26,SF3456789012,PKG003,15.0,10.0,8.0,0.8,GOODS003,CUST003,TRANS003
```

## 📐 数据格式要求

### 1. 理货日期
- 格式：`YYYY-MM-DD`
- 示例：`2024-01-26`
- 不能为空

### 2. 快递单号
- 必须唯一（不能重复）
- 不能为空
- 建议长度：10-20个字符
- 示例：`YT1234567890`

### 3. 集包单号
- 可以为空
- 示例：`PKG001`

### 4. 尺寸（长度、宽度、高度）
- 单位：厘米（cm）
- 格式：数字，可以有小数点
- 可以为空
- 示例：`20.5`

### 5. 重量
- 单位：千克（kg）
- 格式：数字，可以有小数点
- 可以为空
- 示例：`1.5`

### 6. 代码字段（货物代码、客户代码、运输代码）
- 不能为空
- 建议使用字母和数字组合
- 示例：`GOODS001`, `CUST001`, `TRANS001`

## 🔧 文件要求

### 支持的文件格式
- ✅ CSV文件（`.csv`）
- ✅ Excel文件（`.xlsx`, `.xls`）

### 文件大小限制
- 最大：10MB

### 编码要求
- CSV文件必须使用 **UTF-8** 编码
- Excel文件自动处理编码

## 📤 上传步骤

1. **下载模板**
   - 访问：http://localhost:8000/static/templates/理货单上传模板.csv
   - 或使用系统提供的下载链接

2. **填写数据**
   - 打开模板文件
   - 删除示例数据行
   - 填写你的实际数据
   - **不要修改列名**

3. **保存文件**
   - 保存为CSV格式（UTF-8编码）
   - 或保存为Excel格式

4. **上传文件**
   - 登录管理后台
   - 进入"文件上传"页面
   - 选择文件
   - 可选：勾选"仅预览"先查看数据
   - 点击"上传文件"

## ⚠️ 常见错误

### 错误1：未知错误
**原因**：列名不匹配

**解决方案**：
1. 检查CSV文件的第一行（列名行）
2. 确保列名完全匹配模板
3. 不要有多余的空格
4. 使用UTF-8编码保存

### 错误2：文件格式不支持
**原因**：文件格式错误或编码问题

**解决方案**：
1. 确保文件是`.csv`、`.xlsx`或`.xls`格式
2. CSV文件使用UTF-8编码保存
3. 文件大小不超过10MB

### 错误3：快递单号重复
**原因**：文件中有重复的快递单号

**解决方案**：
1. 检查文件中的快递单号
2. 确保每个快递单号唯一
3. 删除重复的行

### 错误4：必填字段为空
**原因**：必填字段没有填写

**解决方案**：
1. 检查以下必填字段：
   - 理货日期
   - 快递单号
   - 货物代码
   - 客户代码
   - 运输代码
2. 确保这些字段都有值

## 🧪 测试上传

### 使用预览模式
1. 勾选"仅预览数据，不保存到数据库"
2. 上传文件
3. 查看预览结果
4. 确认数据正确后，取消勾选再次上传

### 小批量测试
1. 先上传2-3条数据测试
2. 确认上传成功
3. 再上传完整数据

## 📊 批量上传建议

### 数据量建议
- 小文件（< 100行）：直接上传
- 中等文件（100-1000行）：使用预览模式检查
- 大文件（> 1000行）：分批上传

### 分批上传步骤
1. 将大文件拆分成多个小文件
2. 每个文件500-1000行
3. 逐个上传
4. 检查上传结果

## 🔍 验证上传结果

上传成功后，系统会显示：
- ✅ 总行数
- ✅ 有效行数
- ✅ 错误行数
- ✅ 跳过行数

如果有错误：
1. 查看错误详情
2. 修正数据
3. 重新上传

## 💡 最佳实践

1. **使用模板**
   - 始终从官方模板开始
   - 不要修改列名
   - 不要添加或删除列

2. **数据验证**
   - 上传前检查数据完整性
   - 确保快递单号唯一
   - 确保日期格式正确

3. **使用预览模式**
   - 首次上传使用预览模式
   - 确认数据正确后再保存

4. **分批上传**
   - 大量数据分批上传
   - 便于发现和修正错误

5. **保留备份**
   - 上传前保留原始文件
   - 便于出错时重新上传

## 📞 获取帮助

如果遇到问题：

1. **检查日志**
   - 打开浏览器控制台（F12）
   - 查看错误信息

2. **查看错误提示**
   - 系统会显示具体的错误信息
   - 根据提示修正数据

3. **使用测试工具**
   - 访问：http://localhost:8000/test_final_fix.html
   - 运行测试检查系统状态

## 📁 模板文件位置

- 本地路径：`static/templates/理货单上传模板.csv`
- 访问URL：http://localhost:8000/static/templates/理货单上传模板.csv

## ✅ 快速检查清单

上传前检查：
- [ ] 使用官方模板
- [ ] 列名完全匹配
- [ ] 快递单号唯一
- [ ] 必填字段已填写
- [ ] 日期格式正确（YYYY-MM-DD）
- [ ] 数字格式正确
- [ ] 文件编码UTF-8（CSV文件）
- [ ] 文件大小 < 10MB
- [ ] 已使用预览模式测试

---

**提示**：如果仍然遇到"未知错误"，请提供：
1. 上传的CSV文件（前几行）
2. 浏览器控制台的错误信息
3. 服务器日志中的错误信息
