# 理货单上传模板 - 最终版

## ✅ 模板已创建并测试通过

已创建两个版本的模板：
1. **CSV版本**：`static/templates/理货单上传模板.csv` ✅
2. **Excel版本**：`static/templates/理货单上传模板.xlsx` ✅

测试结果：
- ✅ 上传成功
- ✅ 3行数据全部有效
- ✅ 数据格式正确
- ✅ 保存到数据库成功

## 📥 下载模板

### 方式1：直接访问URL
- CSV版本：http://localhost:8000/static/templates/理货单上传模板.csv
- Excel版本：http://localhost:8000/static/templates/理货单上传模板.xlsx

### 方式2：从文件系统
- CSV版本：`static/templates/理货单上传模板.csv`
- Excel版本：`static/templates/理货单上传模板.xlsx`

## 📋 模板格式

### 列名（10列，必须完全匹配）

```
理货日期,快递单号,集包单号,长度,宽度,高度,重量,货物代码,客户代码,运输代码
```

### 示例数据

```csv
理货日期,快递单号,集包单号,长度,宽度,高度,重量,货物代码,客户代码,运输代码
2024-01-26,YT1234567890,PKG001,20.5,15.0,10.0,1.5,GOODS001,CUST001,TRANS001
2024-01-26,ZT9876543210,PKG002,25.0,20.0,15.0,2.0,GOODS002,CUST002,TRANS002
2024-01-26,SF3456789012,PKG003,15.0,10.0,8.0,0.8,GOODS003,CUST003,TRANS003
```

## 🔧 字段详细说明

| 序号 | 字段名 | 必填 | 类型 | 格式/单位 | 示例 | 说明 |
|------|--------|------|------|-----------|------|------|
| 1 | 理货日期 | ✅ | 日期 | YYYY-MM-DD | 2024-01-26 | 理货操作的日期 |
| 2 | 快递单号 | ✅ | 文本 | 唯一标识 | YT1234567890 | 每个单号必须唯一 |
| 3 | 集包单号 | ❌ | 文本 | - | PKG001 | 可选字段 |
| 4 | 长度 | ❌ | 数字 | 厘米(cm) | 20.5 | 可以有小数点 |
| 5 | 宽度 | ❌ | 数字 | 厘米(cm) | 15.0 | 可以有小数点 |
| 6 | 高度 | ❌ | 数字 | 厘米(cm) | 10.0 | 可以有小数点 |
| 7 | 重量 | ❌ | 数字 | 千克(kg) | 1.5 | 可以有小数点 |
| 8 | 货物代码 | ✅ | 文本 | - | GOODS001 | 货物分类代码 |
| 9 | 客户代码 | ✅ | 文本 | - | CUST001 | 客户标识代码 |
| 10 | 运输代码 | ✅ | 文本 | - | TRANS001 | 运输方式代码 |

## 📤 使用步骤

### 步骤1：下载模板
选择CSV或Excel版本下载

### 步骤2：填写数据
1. 打开模板文件
2. **保留第一行（列名）不要修改**
3. 删除示例数据行（第2-4行）
4. 填写你的实际数据

### 步骤3：保存文件
- **CSV格式**：保存时选择UTF-8编码
- **Excel格式**：直接保存即可

### 步骤4：上传文件
1. 登录管理后台：http://localhost:8000/admin/login.html
2. 进入"文件上传"页面
3. 选择你的文件
4. **建议**：首次上传勾选"仅预览数据，不保存到数据库"
5. 点击"上传文件"
6. 查看预览结果
7. 确认无误后，取消勾选"仅预览"，再次上传保存

## ⚠️ 重要注意事项

### 1. 列名必须完全匹配
❌ 错误示例：
- `日期` 而不是 `理货日期`
- `单号` 而不是 `快递单号`
- 使用英文列名

✅ 正确示例：
```
理货日期,快递单号,集包单号,长度,宽度,高度,重量,货物代码,客户代码,运输代码
```

### 2. 快递单号必须唯一
- 同一个文件中不能有重复的快递单号
- 数据库中已存在的单号会被更新

### 3. 日期格式
- 必须使用：`YYYY-MM-DD`
- 示例：`2024-01-26`
- ❌ 错误：`2024/01/26`、`26-01-2024`

### 4. 数字格式
- 可以使用小数点
- 示例：`20.5`、`1.5`
- 不要使用逗号作为千位分隔符

### 5. 文件编码（CSV文件）
- 必须使用UTF-8编码
- 如果用Excel打开CSV后保存，可能会改变编码
- 建议使用记事本或专业编辑器保存为UTF-8

## 🐛 常见错误及解决方案

### 错误1：未知错误

**可能原因**：
- 列名不匹配
- 文件编码不是UTF-8（CSV文件）
- 必填字段为空

**解决方案**：
1. 检查第一行列名是否完全匹配模板
2. CSV文件用记事本打开，另存为UTF-8编码
3. 检查必填字段是否都有值

### 错误2：快递单号重复

**解决方案**：
- 检查文件中是否有重复的快递单号
- 删除重复的行
- 或修改快递单号使其唯一

### 错误3：日期格式错误

**解决方案**：
- 使用格式：`YYYY-MM-DD`
- 示例：`2024-01-26`
- 不要使用其他格式

### 错误4：文件格式不支持

**解决方案**：
- 确保文件是`.csv`、`.xlsx`或`.xls`格式
- 文件大小不超过10MB

## 🧪 测试工具

### 测试模板上传
运行以下命令测试模板是否正确：
```bash
python test_template_upload.py
```

### 创建Excel模板
如果需要重新创建Excel模板：
```bash
python create_excel_template.py
```

## 💡 最佳实践

### 1. 使用预览模式
首次上传时勾选"仅预览"，确认数据正确后再保存

### 2. 小批量测试
先上传2-3条数据测试，成功后再上传完整数据

### 3. 分批上传大文件
- 小文件（< 100行）：直接上传
- 中等文件（100-1000行）：使用预览模式
- 大文件（> 1000行）：分批上传，每批500-1000行

### 4. 保留备份
上传前保存原始文件，便于出错时重新上传

### 5. 数据验证
上传前检查：
- 快递单号是否唯一
- 日期格式是否正确
- 必填字段是否都有值

## 📊 上传结果说明

上传成功后，系统会显示：

```
上传结果:
- 总行数: 3
- 有效行数: 3
- 错误行数: 0

保存结果:
- 插入: 3    (新增的记录数)
- 更新: 0    (更新的记录数)
- 跳过: 0    (跳过的记录数)
```

## 📞 获取帮助

如果遇到问题，请提供：

1. **你的CSV/Excel文件**（前几行数据）
2. **错误提示信息**
3. **浏览器控制台日志**（按F12查看）

## 📁 相关文件

- ✅ `static/templates/理货单上传模板.csv` - CSV模板
- ✅ `static/templates/理货单上传模板.xlsx` - Excel模板
- 📄 `理货单上传模板使用说明.md` - 详细使用说明
- 📄 `理货单上传快速指南.md` - 快速参考指南
- 🧪 `test_template_upload.py` - 测试脚本
- 🔧 `create_excel_template.py` - Excel模板生成脚本

## ✅ 上传前检查清单

- [ ] 使用官方模板（CSV或Excel）
- [ ] 列名完全匹配（中文，10列）
- [ ] 快递单号唯一
- [ ] 必填字段已填写（理货日期、快递单号、货物代码、客户代码、运输代码）
- [ ] 日期格式正确（YYYY-MM-DD）
- [ ] 数字格式正确（可以有小数点）
- [ ] CSV文件编码UTF-8
- [ ] 文件大小 < 10MB
- [ ] 已使用预览模式测试

---

## 🎯 快速开始

1. 下载模板：http://localhost:8000/static/templates/理货单上传模板.csv
2. 填写数据（不要修改列名）
3. 保存为UTF-8编码（CSV）
4. 登录后台上传
5. 先预览，确认后保存

**模板已测试通过，可以直接使用！** ✅
