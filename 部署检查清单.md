# 阿里云服务器部署检查清单

## 📋 部署前准备

### 服务器准备
- [ ] 已购买阿里云ECS服务器（2核4GB或更高）
- [ ] 已选择操作系统（推荐Ubuntu 22.04）
- [ ] 已获取服务器IP地址
- [ ] 已获取SSH登录密码或密钥
- [ ] 已配置安全组规则（开放22、80、443端口）

### 域名准备（可选）
- [ ] 已购买域名
- [ ] 已完成域名实名认证
- [ ] 已完成域名备案（中国大陆服务器必须）

### 本地准备
- [ ] 已安装SSH客户端（Windows用户可用PuTTY或Windows Terminal）
- [ ] 已安装文件传输工具（如WinSCP、FileZilla）
- [ ] 已准备好项目文件

---

## 🔧 环境安装检查

### Docker环境
- [ ] Docker已安装: `docker --version`
- [ ] Docker服务已启动: `systemctl status docker`
- [ ] Docker Compose已安装: `docker-compose --version`
- [ ] 当前用户可以运行Docker: `docker ps`

### 系统工具
- [ ] Git已安装: `git --version`
- [ ] curl已安装: `curl --version`
- [ ] openssl已安装: `openssl version`

### 防火墙配置
- [ ] 防火墙已启用: `ufw status` (Ubuntu) 或 `firewall-cmd --state` (CentOS)
- [ ] 已开放SSH端口(22)
- [ ] 已开放HTTP端口(80)
- [ ] 已开放HTTPS端口(443)
- [ ] 已关闭MySQL端口(3306)对外访问

---

## 📁 项目部署检查

### 文件上传
- [ ] 项目文件已上传到 `/opt/sf-express`
- [ ] 文件权限正确: `ls -la /opt/sf-express`
- [ ] 所有必需文件都存在:
  - [ ] `docker-compose.yml`
  - [ ] `Dockerfile`
  - [ ] `requirements.txt`
  - [ ] `.env.example`
  - [ ] `app/` 目录
  - [ ] `static/` 目录

### 目录创建
- [ ] uploads目录已创建: `/opt/sf-express/uploads`
- [ ] logs目录已创建: `/opt/sf-express/logs`
- [ ] SSL目录已创建: `/opt/sf-express/docker/nginx/ssl`
- [ ] 目录权限正确: `chmod 755`

### 环境配置
- [ ] `.env.production` 文件已创建
- [ ] MYSQL_ROOT_PASSWORD 已设置（强密码）
- [ ] MYSQL_PASSWORD 已设置（强密码）
- [ ] SECRET_KEY 已设置（至少32位）
- [ ] REDIS_PASSWORD 已设置（强密码）
- [ ] KUAIDI100 API配置已填写
- [ ] 密码已保存到安全位置

### SSL证书
- [ ] SSL证书已生成（自签名或Let's Encrypt）
- [ ] 证书文件存在: `/opt/sf-express/docker/nginx/ssl/cert.pem`
- [ ] 密钥文件存在: `/opt/sf-express/docker/nginx/ssl/key.pem`
- [ ] 证书权限正确: `chmod 600`

---

## 🚀 服务启动检查

### Docker容器
- [ ] 所有容器已启动: `docker-compose ps`
- [ ] app容器状态为Up
- [ ] db容器状态为Up
- [ ] nginx容器状态为Up
- [ ] redis容器状态为Up（如果使用）

### 容器日志
- [ ] app容器无错误日志: `docker-compose logs app`
- [ ] db容器无错误日志: `docker-compose logs db`
- [ ] nginx容器无错误日志: `docker-compose logs nginx`

### 数据库
- [ ] 数据库已初始化
- [ ] 数据库迁移已运行: `alembic upgrade head`
- [ ] 管理员账号已创建
- [ ] 可以连接数据库: `docker-compose exec db mysqladmin ping`

---

## 🌐 网络访问检查

### 本地访问（服务器上）
- [ ] 健康检查通过: `curl http://localhost:8000/health`
- [ ] API文档可访问: `curl http://localhost:8000/docs`
- [ ] 前台页面可访问: `curl http://localhost`

### 外部访问（浏览器）
- [ ] 前台可访问: `http://服务器IP`
- [ ] 管理后台可访问: `http://服务器IP/admin/login.html`
- [ ] API文档可访问: `http://服务器IP:8000/docs`
- [ ] 健康检查可访问: `http://服务器IP:8000/health`

### 功能测试
- [ ] 能打开登录页面
- [ ] 能使用admin/admin123登录
- [ ] 登录后能看到仪表板
- [ ] 能访问各个菜单（仪表板、理货单管理、文件上传）
- [ ] 能下载理货单模板
- [ ] 能上传理货单（预览模式）
- [ ] 能查询快递单号

---

## 🔐 安全配置检查

### 密码安全
- [ ] 已修改默认管理员密码（admin/admin123）
- [ ] 数据库密码足够强（至少16位）
- [ ] SECRET_KEY足够强（至少32位）
- [ ] 密码已保存到安全位置
- [ ] 密码文件权限正确: `chmod 600 passwords.txt`

### 防火墙
- [ ] 防火墙已启用
- [ ] 只开放必要端口（22、80、443）
- [ ] SSH端口限制了访问IP（推荐）
- [ ] 数据库端口未对外开放

### SSL/TLS
- [ ] SSL证书已配置
- [ ] HTTPS可以访问（如果配置了域名）
- [ ] HTTP自动跳转到HTTPS（如果配置了）
- [ ] 证书有效期检查: `openssl x509 -in cert.pem -noout -dates`

### 系统安全
- [ ] 已禁用root SSH登录（推荐）
- [ ] 已创建普通用户（推荐）
- [ ] 已配置SSH密钥登录（推荐）
- [ ] 已安装fail2ban（推荐）

---

## 💾 备份配置检查

### 备份脚本
- [ ] 备份脚本已创建: `/opt/backup.sh`
- [ ] 备份脚本有执行权限: `chmod +x`
- [ ] 备份目录已创建: `/opt/backups`
- [ ] 备份脚本测试通过

### 定时任务
- [ ] 已配置crontab定时备份
- [ ] 定时任务格式正确: `crontab -l`
- [ ] 备份时间合理（建议凌晨3点）

### 备份内容
- [ ] 数据库备份正常
- [ ] 上传文件备份正常
- [ ] 配置文件备份正常
- [ ] 旧备份自动清理（保留7天）

---

## 📊 监控配置检查

### 日志管理
- [ ] 应用日志正常写入: `/opt/sf-express/logs/app.log`
- [ ] Nginx日志正常写入: `/opt/sf-express/logs/nginx/`
- [ ] 日志轮转已配置
- [ ] 旧日志自动清理

### 资源监控
- [ ] 可以查看CPU使用率: `htop`
- [ ] 可以查看内存使用率: `free -h`
- [ ] 可以查看磁盘使用率: `df -h`
- [ ] 可以查看Docker资源: `docker stats`

### 告警配置（可选）
- [ ] 已配置监控系统（如Prometheus）
- [ ] 已配置告警规则
- [ ] 已配置告警通知（邮件/短信）

---

## 🎯 性能优化检查

### 数据库优化
- [ ] 已添加必要索引
- [ ] 已优化MySQL配置
- [ ] 已配置连接池
- [ ] 定期清理日志

### 应用优化
- [ ] Worker数量合理（根据CPU核心数）
- [ ] 已启用Redis缓存（如果需要）
- [ ] 静态文件缓存已配置
- [ ] Gzip压缩已启用

### Nginx优化
- [ ] 已配置缓存策略
- [ ] 已启用Gzip压缩
- [ ] 已配置静态文件缓存
- [ ] 已优化连接数限制

---

## 📝 文档和培训检查

### 文档准备
- [ ] 部署文档已保存
- [ ] 密码文档已保存
- [ ] 操作手册已准备
- [ ] 故障排查文档已准备

### 用户培训
- [ ] 管理员已培训
- [ ] 操作人员已培训
- [ ] 测试人员已培训
- [ ] 已提供使用手册

---

## 🔄 更新和维护检查

### 更新流程
- [ ] 已了解更新流程
- [ ] 已测试更新流程
- [ ] 已准备回滚方案

### 维护计划
- [ ] 已制定日常维护计划
- [ ] 已制定周期维护计划
- [ ] 已制定应急响应计划

---

## ✅ 最终验收检查

### 功能验收
- [ ] 所有核心功能正常
- [ ] 所有页面可以访问
- [ ] 所有API接口正常
- [ ] 文件上传下载正常
- [ ] 数据查询正常

### 性能验收
- [ ] 页面加载速度正常（< 3秒）
- [ ] API响应速度正常（< 1秒）
- [ ] 并发处理能力满足需求
- [ ] 资源使用率合理（CPU < 70%, 内存 < 80%）

### 安全验收
- [ ] 所有密码已修改
- [ ] 防火墙配置正确
- [ ] SSL证书有效
- [ ] 无明显安全漏洞

### 稳定性验收
- [ ] 服务运行稳定（24小时无重启）
- [ ] 无内存泄漏
- [ ] 无异常日志
- [ ] 备份恢复测试通过

---

## 📞 联系信息

### 技术支持
- [ ] 已记录技术支持联系方式
- [ ] 已记录紧急联系人
- [ ] 已记录服务商联系方式

### 文档位置
- [ ] 部署文档: `/opt/sf-express/阿里云服务器部署指南.md`
- [ ] 密码文档: `/opt/sf-express/passwords.txt`
- [ ] 备份位置: `/opt/backups`

---

## 🎉 部署完成确认

- [ ] 所有检查项已完成
- [ ] 所有功能测试通过
- [ ] 所有安全配置完成
- [ ] 所有文档已准备
- [ ] 用户培训已完成
- [ ] 项目已正式上线

**部署完成日期**: _______________

**部署负责人**: _______________

**验收负责人**: _______________

---

## 📚 相关文档

- [阿里云服务器部署指南.md](阿里云服务器部署指南.md) - 完整部署指南
- [阿里云部署快速参考.md](阿里云部署快速参考.md) - 快速参考卡片
- [问题汇总与解决方案.md](问题汇总与解决方案.md) - 常见问题解决

---

**注意**: 请按顺序完成所有检查项，确保部署质量！
